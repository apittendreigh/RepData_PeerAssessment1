---
title: "Reproducible Research: Peer Assessment 1"
author: Alex Pittendreigh
date: "17 October 2014"
output: 
  html_document:
    keep_md: true
---
# Reproducible Research: Peer Assessment 1 #

## Introduction ##

It is now possible to collect a large amount of data about personal movement activity monitoring devices such as a [Fitbit](http://www.fitbit.com), [Nike Fuelband](http://www.nike.com/us/en_us/c/nikeplus-fuelband) or [Jawbone Up](http://jawbone.com/up). However, the data generated by these devises tend to remain under-utilised because the data is hard to obtain and/or there is a lack of statistical methods and software for processing and interpreting this data.

This assessment will use a small sampling of data from one such device to answer questions regarding the activity performed over a two month period.

## Data ##

The device collects data at 5 minute intervals throughout the day and consists of two months of data from an anonymous individual gathered during the months of October and November in 2012. The original data set is located at [https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2Factivity.zip](https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2Factivity.zip) as at the 17th October 2014, however, this analysis will used the file provided in the Github repo provided by Dr Peng and is named **activity.zip**. The extracted raw data file from this archive is a comma separated value file called **activity.csv** and consists of 3 variables and 17568 observations.

The columns in this raw data set are:

1. **steps**: The number of steps taken in a 5 minute period with missing data indicated with NA  
2. **date**: Dates of the recorded activity in "YYYY-MM-DD" format  
3. **interval**: Identifier for the 5 minute interval in which the measurement was taken  

## Goal of Analysis ##

The broad questions that this analysis will answer are:

1. What is the mean total number of steps taken each day?
2. What is the average daily activity pattern?
3. Inputting missing values
4. Are there differences in activity patterns between weekdays and weekends?

This analysis will answer each of these questions in order and provide a number of tables and plots,

## Analysis ##

This analysis assumes that the raw data file exists and that you have manually extracted it's contents into the current working directory.

### Loading and Preprocessing Data ###

Firstly lets load some needed libraries that will help manipulate the data

```{r}
library(plyr)
# No need to see the startup messages when loading dplyr
suppressPackageStartupMessages(library(dplyr))  
```

Then load the data and inspect the contents.

```{r}
activities <- tbl_df(read.csv('activity.csv'))

# Convert the 'date' column to a true date type
activities$date <- as.Date(activities$date)

activities
str(activities)
```

Looks to be pretty tidy data aside from the NA values which will be addressed shortly. We can proceed to perform the analysis for the first set of questions.

### Q1 - What is the mean total number of steps taken per day? ###

The first step is to summarise the data into a new data-frame giving the total number of steps per day. As the missing values can be hard to determine (i.e. they may be zero or may be plenty) we need to remove them from the summary data frame. After summarising the data, let's inspect the new data frames values

```{r}
dailyStepsTally <- activities %>%
    filter(!is.na(steps)) %>%
    group_by(date) %>%
    summarise(totalSteps=sum(steps))

dailyStepsTally
```

Looks to be pretty valid information, so let's plot in out to gain a visual perspective of this data. The plotting system used is ggplot2 by Hadley Wickham.

```{r figure1, fig.width=12}
library(ggplot2)

ggplot(subset(dailyStepsTally, !is.na(totalSteps)), aes(date, totalSteps)) +
    geom_histogram(stat="identity", aes(fill=totalSteps)) +
    ggtitle("Total Daily Steps") +
    xlab("Date") +
    ylab("Number of Steps") +
    theme(axis.text.x=element_text(angle=90))
```

It would also be handy to know what â€ he mean and median values for the daily steps taken are:

```{r}
dailySteps.sum <- sum(dailyStepsTally$totalSteps)
dailySteps.mean <- format(mean(dailyStepsTally$totalSteps), digits = 9)
dailySteps.median <- median(dailyStepsTally$totalSteps)
```

| Sum | Mean | Median |
|----:|-----:|-------:|
| `r dailySteps.sum` | `r dailySteps.mean` | `r dailySteps.median` |     

### Q2 - What is the average daily activity pattern? ###

The aggregate function is used on the original data frame to produce a new data frame with the average number of steps for each time interval over all days. We can examine what this results in by running the code

```{r}
activityMeans <- aggregate(steps ~ interval, data=activities, FUN=mean) 
activityMeans
```

The data-frame has 288 observations which equate to every 5 minute time period during a day. This data can then be plotted using ggplot to graphically show the average peaks and troughs of activity through the day.

```{r  figure2, fig.width=12}
ggplot(activityMeans, aes(interval, steps)) +
    geom_line() +
    ggtitle("Average Steps over 5 Minute Time Intervals") + 
    xlab("time Intervals") + 
    ylab("Number of Steps")
```

This plot shows some rather interesting points. There is very little activity before 5.30am (due to the likelihood of being asleep) and again from around 9:30pm. The major activity averages out from 8:30am to 9:00am with a lesser spike around lunchtime as well as mid and late afternoon.

To find out when the actual time period has the greatest activity, we need to go back to the original data frame, eliminate the na values and sort it by interval. The last observation in the resulting set is the answer and can be achieve by running the following code:

```{r}
steps <- activities %>%
    filter(!is.na(steps)) %>%
    arrange(steps)

maxInterval <- steps$interval[nrow(steps)]
maxDate <- format(steps$date[nrow(steps)], '%B %d, %Y')
maxSteps <- steps$steps[nrow(steps)]
```

Giving us the answer that the interval **`r maxInterval`** on **`r maxDate`** had the maximum number of steps, being **`r maxSteps`**.

### Q3 - Inputting missing values ###

We need to check to see what missing values are contained in the original data. In the previous questions they have simply been eliminated from the analysis. This is one method to handle missing values but certainly not the only one. In this section we will discuss another method of dealing with these missing values, and what the ramifications of this method is.

Firstly we need to check the original data set and find out how many missing values need to be handled.

```{r}
table(is.na(activities$date))
table(is.na(activities$interval))
table(is.na(activities$steps))
```

As expected there are no missing values for the date or the interval columns, leaving only the steps column to deal with. Lets replace these missing values with the median values (not ideal as discussed below). 

First create a new data-frame with the NA values replaced by the median steps.

```{r}
activities.complete <- activities %>%
    group_by(interval) %>%
    mutate(steps = ifelse(is.na(steps), 
                          median(steps, na.rm = T), 
                          steps))

table(is.na(activities.complete$steps))
```

And let's plot this data to visualise the total steps again to compare it to the first figure in this assessment. 

Firstly we need to summarise the data...

```{r}
dailyStepsTally <- activities.complete %>%
    group_by(date) %>%
    summarise(totalSteps=sum(steps))

dailyStepsTally
```

... then plot it...

```{r figure3, fig.width=12}
ggplot(dailyStepsTally, aes(date, totalSteps)) +
    geom_histogram(stat="identity", aes(fill=totalSteps)) +
    ggtitle("Total Daily Steps") +
    xlab("Date") +
    ylab("Number of Steps") +
    theme(axis.text.x=element_text(angle=90))
```

... and finally calculate the mean and median of this new data set.

```{r}
dailySteps.sum <- sum(dailyStepsTally$totalSteps)
dailySteps.mean <- format(mean(dailyStepsTally$totalSteps), digits = 8)
dailySteps.median <- median(dailyStepsTally$totalSteps)
```

| Sum | Mean | Median |
|----:|-----:|-------:|
| `r dailySteps.sum` | `r dailySteps.mean` | `r dailySteps.median` |     

#### Conclusion ####

Comparing the above plot to that produced for question 1 shows that while the pattern is similar, some of the missing days have been added to the plot. However, there are differences in the mean and mean values in this data set in that both figures are lower by 300-400 steps. This can be explained by adding in the extra data values (>2000) into the set which all tend to now have low step counts.

The analysis done in this assessment was to use the median values of the steps as a whole. While this technique tended not to skew the data significantly it is far from ideal. A better solution would have been to have used the median values for each corresponding time interval. My thought process on how to do this is shown in the included scratchpad code file, where I simply ran out of time before submission to debug why it was not working as expected. Not doubt reviewing it later will find my error.

Even so, this technique is still not ideal. In an ideal world we would need to do some further investigation to find out why there are NA values in the original data and then make a better decision on whether to exclude or include them with a transformation.

### Q4 - Are there differences in activity patterns between weekdays and weekends ###

In order to answer this question it is necessary to be able to identify which date is a weekday and which fall on a weekend. The easiest way to do this is to add a column to our data set identifying where each date falls.

```{r}
activities.complete <- activities.complete %>%
    mutate(dayType = ifelse(weekdays(date) == 'Saturday' | 
                            weekdays(date) == 'Sunday', 
                            'Weekend', 'Weekday'))

activities.complete$dayType <- as.factor(activities.complete$dayType)

activities.complete
```

And then this needs to be tallied up so we have a dataset tabling the total steps for each time interval broken down by weekdays and weekends.

```{r}
stepsTally <- activities.complete %>%
    group_by(dayType, interval) %>%
    summarise(avgSteps = mean(steps))

stepsTally
```

Which will allow us to plot the weekday and weekend activity for comparison.

```{r figure4, fig.width=12}
ggplot(stepsTally, aes(interval, avgSteps)) +
    geom_line() +
    facet_grid( dayType ~ .) + 
    ggtitle("Average Steps over 5 Minute Time Intervals") + 
    xlab("time Intervals") + 
    ylab("Number of Steps")
```